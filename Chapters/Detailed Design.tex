\documentclass[11pt]{report}
\usepackage{StyleSheets/main}
\begin{document}

\chapter{Detailed Design}\label{ch:detailed-design}
This section will give a detailed design of the vehicle, its components, and special design features. It is to serve as a breakdown of the vehicle's structure, detailing every part of the vehicle. In this section, the vehicle's special design features, a decomposition of the structure, circuitry of the vehicle, and the software architecture will be discussed and detailed. 

\section{Body of the Vehicle}
\subsection{General Structure}
The base of this vehicle's structure is a singular 1116 Series Grid Plate (to be referred to as bottom grid plate). This grid plate has a  29 x 53 hole configuration, with each hole being $\SI{40}{\milli\meter}$ in diameter. The size of the bottom grid plate is 232 x $\SI{424}{\milli\meter}$, and is $\SI{2.5}{\milli\meter}$ thick. This grid plate serves as a strong and sturdy base for the structure of the vehicle, and is at the core of all connections made. One of the $\SI{232}{\milli\meter}$ ends of the vehicle will be recognized as the front end of the vehicle. At the back end of the vehicle were 2 U-shaped connecting pieces, which served as a cover for the battery. These U-shaped pieces were placed on both sides of the vehicle, and the $\SI{12}{\volt}$ battery was placed with its full length being perpendicular to the length of the grid plate. On top of this U-shaped connector, was placed another grid plate. This grid plate was of the same specification as the original grid plate, although it was also placed perpendicular to the length of the bottom grid plate, and in the same orientation as the battery. On top of this top grid plate, were placed the 2 breadboards which were used in this project. One breadboard served as a place to house the Teensy microcontroller, and the other was used for power distribution around the circuit as well as an \gls{LED} to indicate the state of the system. The breadboards and Teensy 4.1 microcontrollers will be discussed in a future section of the detailed design. 

\par On the front of the bottom grid plate was placed the gripper. The structure of the gripper will be detailed in future sections. On either side of the gripper was placed a mount for the ultrasonic and color sensors. These sensor mounts allowed for the vehicle to complete the tasks of color recognition, obstacle avoidance, and line following. Underneath the bottom grid plate sat the motor controllers which were placed with spacers between the plate and the controllers to avoid unwanted interruptions in the circuit. 2 motor controllers were used, each powering 2 of the 4 motors used. The 4 motors, attached to the vehicle using 2 side clamping mounts, were placed on each side of the vehicle, in the middle of each length. These mounts were placed underneath the bottom grid plate, and each had a brushed \gls{DC} 26 \gls{RPM} motor attached. To the ends of these motors, was attached an omni wheel, which allowed the vehicle to move in any direction in a crab-walk configuration. Over the front wheel and underneath the gripper was placed a sensor mount, which allowed for the attachment of an additional ultrasonic sensor in front of the vehicle, which was in the center and further forward than the other sensors. 
\subsection{Wheels}
The system utilized a crab-walk design, having a wheel on either side of the vehicle as well as the front and back. This configuration allowed for the vehicle to have 2 degrees of freedom in movement, with the side wheels allowing for forward and backwards movement and the back and front wheels allowing for side to side movement. The wheels, which were chosen to be omni-wheels, allowed for the smooth movement of the vehicle in every direction. This design allowed for higher speeds in every direction, with each direction of movement allowing 2 motors to push the necessary wheels. 
\par During testing, the issue of the wheels slipping during sideways movement of the vehicle came up. The weight was unevenly distributed throughout the robot, causing it to not allow the side wheels to both be in contact with the ground at a time. The solution for this problem was to introduce a suspension system, which allowed the motor mounts to bend outwards allowing the vehicle to have all wheels in contact. On the right side of the vehicle, a spring was placed along with a series of washers to the motor mounts connection points with the grid plate. This allowed the connection to be looser and have more flexibility. On the other side of the vehicle, the bottom of the motor mount included springs, which pulled the wheel closer to the vehicle but allowed for more flexibility. The introduction of the suspension system allowed the robot to move in every direction effectively. 
\subsection{Motors}
The motors attached to these wheels were 26 \gls{RPM} \gls{DC} motors. These motors provided the vehicle with the necessary speed to complete the tasks in a faster time. The side 26 \gls{RPM} motors were modified using 116 \gls{RPM} motor’s gearboxes, which gave the vehicle additional speed in the forward and backward directions. 
\subsection{Battery}
The battery used in this vehicle was a $\SI{12}{\volt}$ battery with an on and off switch, a charging port, and a connection port for wires to be connected to the rest of the circuit. All of the vehicle’s power came from this battery. The placement of the battery allowed for easy changing between on and off during testing, which simplified the process massively. The battery being situated at the back of the vehicle allowed for the weight to be distributed evenly throughout the vehicle, as it balanced the weight of the gripper on the front. The wiring of the battery to the rest of the circuit will be discussed in later sections. 
\subsection{3-D Printed sensor mounts}
\subsubsection{Ultrasonic Sensor and Color Sensor Mounts}
The ultrasonic sensors and color sensors were placed on the 3D printed sensor mounts. The design is shown in \hl{FIGURE}. These mounts were attached to the bottom grid plate on either side of the vehicle’s front wheel. The side sensor mounts were designed to house the ultrasonic sensors in a position where they would sense further outwards than the furthest edge of the wheel to avoid the vehicle hitting the obstacles during the tests. The ultrasonic sensors were placed in a forward facing position, while the color sensors were attached facing towards the floor for color recognition. The color sensors were housed by a curtain as a part of the sensor mounts to avoid external light messing with the color sensing ability.
\subsubsection{Front-Central Ultrasonic Sensor Mount}
The middle ultrasonic sensor mount had a design to which it would attach to the top of the bottom grid plate and curve over the top of the front wheel. This curve was such that it would not interfere with the front wheel, and there was sufficient space for the attachment of wires to the ultrasonic sensor without interference. This design allowed for the central front facing ultrasonic sensor to be further forward than the rest of the vehicle, and allowed for the vehicle to sense the platform on which the box is located for the pickup and placement test. The front-central ultrasonic sensor mount can be seen in \hl{FIGURE}.
\subsubsection{Lower Infrared Sensor Mount}
The vehicle’s infrared sensor mount was located beneath the vehicle, and allowed for the \gls{IR} sensor to be as close to the ground as possible for its primary use of line following. The mount was attached to the motor mount of the front wheel, and the \gls{IR} sensor was located right underneath this mount. The sensor mount also acted as an electrical spacer to avoid unwanted contact with metals and the \gls{IR} sensor. The lower \gls{IR} sensor mount can be seen in \hl{FIGURE}. 
\section{Gripper}
\subsection{Gripper Arm}
The arm of the gripper was made up of many plates and connecting pieces. Firstly, a U-shaped connection plate was attached to the front of the vehicle, occupying the same holes in the grid plate as the front-central ultrasonic sensor and the front wheel. This U-shaped plate raised the gripper above the vehicle and allowed for the gripper to not come in contact with the wheel.Attached to this is another U-shaped plate of the same shape, and inside this is the servo motor which controls the movement of the gripper arm. This servo motor allows the gripper to move with one degree of freedom, and controls the angle at which the gripper is facing. The servo motor is attached to the rest of the arm using a metal rod which is attached to a longer plate. This longer plate extends the length of the gripper arm, and allows the hand of the gripper to reach the box in the pickup and placement system. The end of this arm plate marks the end of the gripper arm before the hand system starts, with a U-shaped grid plate attached to the end of the arm. 
\subsection{Gripper Hand}
The gripper hand is made up from multiple smaller components. Attached to the gripper arm is the claws of the gripper, which are 2 pieces of plastic with extensions to reach the box. These extensions are controlled using a gear system which is connected to another servo motor, which has the use of controlling the opening and closing of the gripper hand. The ends of the extensions have 3D printed mounts attached, which will be detailed shortly. 
\subsection{Gripper Sensor Mounts and Sensors}
The sensors for the gripper hand were attached to the claw of the gripper using 3D printed sensor mounts. The sensors on the gripper were used to determine box size, box color, and height of the gripper above the platform. 
\subsubsection{Left Gripper Sensor Mount and Sensors}
The left sensor mount was used as an extension to the gripper claw which allowed for the vehicle to more effectively grab the box. Within the extension was placed the color sensor, which had the task of sensing whether the box was blue or red. The left gripper sensor mount can be seen in \hl{FIGURE}.
\subsubsection{Right Gripper Sensor Mount and Sensors}
The sensor mount on the right hand side of the vehicle’s gripper had the purpose of allowing the box to be better grabbed as it was an extension of the claw, and also served as a place for an infrared sensor and a button. The infrared sensor allowed the robot to know when it was near the platform and could drop the box. The button had the purpose of letting the robot know which size box was being picked up. The time from when the gripper started closing and when the button was pressed was measured and the robot used this information to determine the box size. The right gripper sensor mount can be seen in \hl{FIGURE}.

\section{Breadboards and Pins}
\subsection{Teensy 4.1 Microcontroller}
Placed on one breadboard was the Teensy 4.1 Microcontroller. The microcontroller was an integral part of this system which allowed a computer to communicate with the robots movements and features using code which was implemented to the system. The Teensy 4.1 microcontroller has a series of pins which connect to the color sensors, the ultrasonic sensors, the infrared sensors, the motors (through the motor controllers), and the servo motors. The Teensy 4.1 pinout map can be seen in \hl{FIGURE}. 
\par Each pin in the Teensy 4.1 had a wire connecting it to the required part of the robot, in a complicated wire network which is discussed shortly. 
\subsection{DC-DC Converters}
The second breadboard used contained two \gls{DC}-\gls{DC} converters (buck converters). These were used to bring the voltage from the $\SI{12}{\volt}$ battery down to a more usable voltage for the system, and was controlled using a potentiometer built into the buck converter. 
\par One DC-DC converter was used to step down the $\SI{12}{\volt}$ from the battery to $\SI{7.4}{\volt}$ for the use of the motors which drive the vehicle. This voltage allowed the motors to operate at maximum capacity. The other converter was used to power the Teensy 4.1, stepping the voltage down to $\SI{5}{\volt}$. 
\subsection{LED System}
The \gls{LED} system on the breadboard represented a system to show whether the battery was turned on or not. If the battery was on, the \gls{LED} would shine and if not, it would e off. This helped know whether the system was active or not. The \gls{LED} was connected to the system using the voltage from the \gls{DC}-\gls{DC} converters and a resistor in series with the \gls{LED}. 
\section{Wiring}
\subsection{Sensors}
In testing, it became clear that wiring would be an important factor for the simplicity of the system. The final robot had a simplified wiring system for the sensors. Each sensor has a set of pins to which connections need to be made. The color sensor pin map can be seen in \hl{FIGURE}. 
\par At the front of the robot, the sensor mounts allowed for the wires of the ultrasonic and color sensor wiring to be greatly simplified and to not interrupt any other use of the vehicle. The wires and wire extensions connected the sensors to the Teensy 4.1 microcontroller in their respective ports.
\subsection{Gripper}
The wiring on the gripper was important as it is a moving piece and could mess up the system if done incorrectly. The gripper, the servo motors, and the gripper sensors all connected back to the Teensy microcontroller. 
\subsection{Motor Controllers}
The two motor controllers situated underneath the lower grid plate bot controlled two motors each. This was done by making the motors closest to the controller the connection. The wires were soldered together at a connection point and then connected to the Teensy and buck converter. 
\subsection{Simplification and Neatness Strategy}
Making sure the wiring in the system was neat and usable was a very important part of this robot. The wires were held together using cable ties, and were attached to the grid plate using the same method. This ensured that all wires from a particular sensor were held together and there were no loose wires. The sensor mounts allowed for additional simplification, as well as the soldering of the motor and motor controller wires. 
\par Each wire corresponded with a particular color in accordance to \hl{FIGURE}, which helped maintain the simplicity of the system and allowed for knowing what comes where. 
\section{Code}
\subsection{Color Sensors}
The basic use of the color sensors was for the robot to recognize certain colors and make decisions based on that recognition. 

\par The color sensors on the mounts under the base of the vehicle allowed the vehicle to sense colors of lines. For the obstacle avoidance test, the vehicle used these color sensors to recognize the end of the obstacle course which was represented by a white line. Once the vehicle saw this white line, a delay was implemented into the code and the vehicle would come to a stop. In the line following test, the vehicle would use the color sensors to recognize the green lines at the starting and ending point of the course. The color sensors were also used when the vehicle was turning around, as it used them to recognize when it was on and off the line. The color sensors at the bottom of the vehicle were also used to recognize the edge of the course for both tests, stopping when the sensors recognized the white lines at the sides.

\par The color sensor on the gripper was important for the robot to recognize which path it would follow based on which color box it picked up. If the gripper sensed that the box was blue, the robot would then follow the blue line, and if the gripper sensed that it was red, it would follow the red line. 

\subsection{Ultrasonic Sensors}
The 3 ultrasonic sensors had 2 different uses. The outer ultrasonic sensors were used in the obstacle avoidance testing, allowing for the vehicle to sense when an obstacle was blocking the vehicle. The sensor mounts allowed for these ultrasonic sensors to be wider than the wheels allowing the vehicle to not hit the obstacles on passing, due to the nature of how the sensors project. If the ultrasonic sensors sensed something was in the way, the vehicle was programmed to move sideways until it found a way through. 

\par The central ultrasonic sensor was used to recognize the distance from the vehicle to the platform for the box pickup and placement. This allowed the vehicle to get to the best possible distance for the gripper to grab the box effectively and allow the button on the box to be pressed. 

\subsection{Infrared Sensors}
The two \gls{IR} sensors in this robot had different uses. The \gls{IR} sensor on the underside of the vehicle had the purpose of line following. This \gls{IR} sensor acted as an array with 8 sensors. Since the \gls{IR} sensor was placed in the middle of the vehicle, if the \gls{IR} sensor had it's middle sensors activated, the vehicle was correctly following the line. If the sensors on the right of the \gls{IR} were activated, the vehicle would correct its line and move to the right. If the sensors on the left of the \gls{IR} were activated, the vehicle would correct and move to the left. This was implemented as the best form of line following due to the inconsistencies of the color sensors as a line following mechanism. 
\par The \gls{IR} sensor on the gripper was used for the robot to know when the gripper hand was above the platform. When the robot reached the T-junction in the pickup and placement course, the gripper hand was lowered to just above the height of the platform. The robot then followed the correct line to where it should drop the box on the platform, and once the \gls{IR} sensor sensed that the platform was right beneath the hand, the servo motor would lower the gripper to the platform, placing the box down.

\subsection{Gripper Button}
The mechanism of the gripper button allowed the robot to know what size box it was handling. When the gripper started to close around the box, a timer was started. When the button was activated by the box pressing against it, the timer stopped. If this time was below a certain threshold, the box was deemed to be a large box. If this time was above a certain threshold, the box was deemed to be a small box. 
\end{document}